<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>增强美观性的左侧导航栏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="../styles/sidebar.css">
    <link rel="stylesheet" href="../styles/style_transfer.css">
</head>

<body>
    <div id="sidebar">
        <div class="user_info">
            <h2>用户名:</h2>
        </div>
        <ul>
            <li>
                <a href="./transfer.html"><i class="fas fa-file-upload"></i>文件传输</a>
            </li>
            <li>
                <a href="./img_browser.html"><i class="fas fa-images"></i>查看手机照片</a>
            </li>
            <li>
                <a href="./settings.html"><i class="fas fa-cogs"></i>设置</a>
            </li>
        </ul>
        <div class="signal-container"> <!-- 用于容纳信号图标 -->
            <div class="signal-icon"><i class="fas fa-signal"></i></div> <!-- 信号图标小方块 -->
        </div>
    </div>
    <div id="content">
        <div class="left-content">
            <h2>Transfer Info</h2>
            <textarea name="transfer_info" id="transfer_info" readonly>
传输信息：
            </textarea>
        </div>
        <div class="right-content">
            <h2>选择本地文件</h2>
            <input type="file" id="fileInput">
            <button id="upload_btn">上传</button>
        </div>
    </div>

    <script>
        // 模拟接收后端信息并改变信号图标颜色的示例代码
        setTimeout(function () {
            document.querySelector('.signal-icon').classList.add('connected'); // 当接收到后端信息后，添加 connected 类来改变颜色为绿色
        }, 1000); // 3秒后模拟接收到后端信息

        const socket = new WebSocket('ws://localhost:8080/ws');
        var info = document.getElementById('transfer_info');

        socket.onmessage = function (event) {
            const data = JSON.parse(event.data);
            const messageInput = document.getElementById('transfer_info');
            info += data.message; // 实时更新文本框中的消息字符串
            info += "你好吗";
        };

        var info = document.getElementById('transfer_info');
        info.value = "你好";


        document.getElementById('upload_btn').addEventListener('click', function () {
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];

            if (file) {
                var formData = new FormData();
                formData.append('file', file);

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (response.ok) {
                            alert('File uploaded successfully');
                        } else {
                            alert('Failed to upload file');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            } else {
                alert('Please select a file to upload');
            }
        });
    </script>
    <script src="./main.js">
    </script>
</body>

</html>